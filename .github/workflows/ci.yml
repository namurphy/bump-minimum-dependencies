# Define continuous integration (CI) checks to be performed during
# pull requests, such as running tests and building documentation.
#
# The checks are defined in noxfile.py. After installing uv, the checks
# can be run locally with
#
#    uvx nox -s '<nox_session>'
#
# where <nox_session> is replaced by the name of the session. Quotes are
# necessary around <nox_session> when it contains parentheses.

name: CI

on:
  push:
    branches:
    - main
    tags:
    - '*'
  pull_request:
  workflow_dispatch:

permissions: {}

jobs:

  checks:
    name: ${{ matrix.nox_session }}
    runs-on: ubuntu-latest
    timeout-minutes: 10

    strategy:
      fail-fast: false

      matrix:
        include:

        - nox_session: lint
        - nox_session: test
        - nox_session: mypy
        - nox_session: ty
        - nox_session: build
        - nox_session: run

    steps:

    - name: Checkout code
      uses: actions/checkout@v5
      with:
        persist-credentials: false

    - name: Install uv
      uses: astral-sh/setup-uv@v7
      with:
        activate-environment: true
        enable-cache: true
        cache-suffix: ${{ matrix.nox_session }}

    - run: uv pip install . --group dev

    - name: Run the check
      run: nox -s '${{ matrix.nox_session }}'
